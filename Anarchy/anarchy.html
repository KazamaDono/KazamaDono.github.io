<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anarchy</title>
  <meta name="description" content="Ghost‑in‑the‑Shell style hub for members to find and launch courses. Fixed edition." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    // Tailwind config: extended aqua/teal neon palette
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            display: ['Orbitron', 'ui-sans-serif', 'system-ui'],
            mono: ['Share Tech Mono', 'ui-monospace', 'SFMono-Regular']
          },
          colors: {
            bgd: {
              DEFAULT: '#070b0c',
              deep: '#050808',
              glow: '#0b1f1f'
            },
            neon: {
              cyan: '#00e5ff',
              teal: '#00ffc6',
              ice: '#a7fff4'
            }
          },
          boxShadow: {
            glow: '0 0 20px rgba(0,229,255,.25), inset 0 0 20px rgba(0,255,198,.1)'
          },
          backgroundImage: {
            grid: 'linear-gradient(transparent 97%, rgba(0,229,255,.08) 98%), linear-gradient(90deg, transparent 97%, rgba(0,229,255,.08) 98%)'
          }
        }
      }
    }
  </script>

  <style>
    /* Binary Rain Canvas overlay (z-index 0 so other elements with higher z-index sit above reliably) */
    #binaryCanvas { position: fixed; inset: 0; z-index: 0; filter: drop-shadow(0 0 6px rgba(0,229,255,.35)); opacity: .12; pointer-events: none; }
    /* Subtle scanlines */
    .scanlines::after { content: ""; position: fixed; inset: 0; pointer-events: none; background: repeating-linear-gradient(to bottom, rgba(0, 255, 230, .04), rgba(0, 255, 230, .04) 1px, transparent 2px, transparent 3px); mix-blend-mode: overlay; opacity: .4; }
    /* Neon focus ring */
    .neon-focus:focus { outline: none; box-shadow: 0 0 0 2px rgba(0,229,255,.6), 0 0 0 6px rgba(0,255,198,.25); }
    /* Glitch hover for logo */
    .glitch:hover { text-shadow: 1px 0 0 #00e5ff, -1px 0 0 #00ffc6; transform: translateY(-1px); }
    /* Card hover line */
    .card:hover .card-line { transform: scaleX(1); }
    .card-line { transform-origin: left; transition: transform .5s ease; transform: scaleX(0); }
    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      #binaryCanvas { display: none; }
      .scanlines::after { display: none; }
    }
    /* Tiny utilities */
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
    /* Modal backdrop */
    .modal-backdrop { background: linear-gradient(90deg, rgba(0,229,255,.03), rgba(0,255,198,.02)); backdrop-filter: blur(6px); }
    /* Toggle switch */
    .switch { width: 44px; height: 24px; background: rgba(255,255,255,.04); border-radius: 999px; position: relative; display: inline-block; vertical-align: middle; }
    .switch .dot { width: 18px; height: 18px; background: #00e5ff; border-radius: 50%; position: absolute; top: 3px; left: 3px; transition: all .25s ease; box-shadow: 0 2px 6px rgba(0,0,0,.5); }
    .switch.on { background: linear-gradient(90deg, rgba(0,229,255,.12), rgba(0,255,198,.12)); }
    .switch.on .dot { left: 23px; background: #00ffc6; }

    /* Tiny keyboard hint */
    .kbd { font-family: 'Share Tech Mono', monospace; font-size: 11px; padding: 4px 6px; border-radius: 4px; border: 1px solid rgba(255,255,255,.06); background: rgba(0,0,0,.2); }

    /* Responsive tweaks */
    @media (max-width: 640px) {
      .hero-split { grid-template-columns: 1fr !important; }
    }
  </style>
</head>
<body class="scanlines bg-bgd text-slate-200 selection:bg-neon-cyan/30 selection:text-white">

  <!-- Binary rain canvas (tinted) -->
  <canvas id="binaryCanvas" aria-hidden="true"></canvas>

  <!-- Top Bar -->
  <header class="sticky top-0 z-50 backdrop-blur bg-bgd/70 border-b border-teal-900/30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center gap-4">
      <div class="flex items-center gap-3">
        <!-- HUD logo -->
        <button id="logoBtn" aria-label="Neo Aqua Home" class="flex items-center gap-3 group">
          <svg class="w-9 h-9" viewBox="0 0 64 64" fill="none" aria-hidden="true">
            <circle cx="32" cy="32" r="22" stroke="#00e5ff" stroke-width="2" opacity=".7" />
            <path d="M32 10v6M32 48v6M10 32h6M48 32h6" stroke="#00ffc6" stroke-width="2" opacity=".8" />
            <circle cx="32" cy="32" r="6" stroke="#00ffc6" stroke-width="2" />
          </svg>
          <div class="text-left">
            <h1 class="font-display text-xl sm:text-2xl tracking-widest glitched leading-none">ANARCHY</h1>
            <p class="font-mono text-xs text-slate-400">Your Personal Student Course Portal</p>
          </div>
        </button>
      </div>

      <div class="ml-auto flex items-center gap-3 w-full max-w-2xl">
        <label for="q" class="sr-only">Search courses</label>
        <input id="q" type="text" placeholder="Search courses, tags, stacks…" class="neon-focus w-full rounded-xl bg-bgd-deep/80 border border-teal-900/40 px-4 py-2 font-mono placeholder:text-slate-500" />
        <button id="clearSearch" title="Clear search" class="rounded-xl border border-teal-900/40 px-3 py-2 font-mono text-xs hover:bg-bgd-glow/60">Clear</button>
        <button id="openSettings" title="Open settings" class="rounded-xl border border-teal-900/40 px-3 py-2 font-mono text-xs hover:bg-bgd-glow/60">⚙</button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="relative overflow-hidden">
    <div class="pointer-events-none absolute inset-0 bg-grid bg-[length:40px_40px] opacity-[.07]"></div>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="grid md:grid-cols-2 gap-8 items-center hero-split">
        <div>
          <h2 class="font-display text-3xl sm:text-4xl md:text-5xl leading-tight">
            <span class="text-neon-cyan">Welcome</span> back, operative.<br/>
            <span class="text-neon-teal">Your</span> training awaits.
          </h2>
          <p class="mt-4 text-slate-400 max-w-prose">Master the art of cyber operations. Explore exploitation, adversarial AI, and defensive strategies—designed for the minds who don’t just follow the system, but understand it.</p>

          <div class="mt-6 flex flex-wrap gap-3 font-mono text-xs" role="tablist" aria-label="Course filter chips">
            <button class="filter-chip active rounded-full border border-teal-900/40 px-3 py-1 hover:bg-bgd-glow/50" data-filter="all" role="tab" aria-selected="true">All</button>
            <button class="filter-chip rounded-full border border-teal-900/40 px-3 py-1 hover:bg-bgd-glow/50" data-filter="aiml" role="tab">AI/ML</button>
            <button class="filter-chip rounded-full border border-teal-900/40 px-3 py-1 hover:bg-bgd-glow/50" data-filter="exploits" role="tab">Exploits</button>
            <button class="filter-chip rounded-full border border-teal-900/40 px-3 py-1 hover:bg-bgd-glow/50" data-filter="psyops" role="tab">PsyOps</button>
            <button class="filter-chip rounded-full border border-teal-900/40 px-3 py-1 hover:bg-bgd-glow/50" data-filter="bio" role="tab">Bio/Med</button>
            <button class="filter-chip rounded-full border border-teal-900/40 px-3 py-1 hover:bg-bgd-glow/50" data-filter="infra" role="tab">Infra</button>
            <button class="filter-chip rounded-full border border-teal-900/40 px-3 py-1 hover:bg-bgd-glow/50" data-filter="blue" role="tab">Defensive</button>
          </div>

          <div class="mt-4 flex gap-3 font-mono text-xs">
            <span class="kbd">/</span>
            <span class="text-slate-400">Press <strong class="font-semibold">/</strong> to focus search • <span id="kbdHint" class="text-slate-400">Esc clears</span></span>
          </div>

        </div>

        <div class="relative">
          <div class="rounded-2xl border border-teal-900/40 p-6 shadow-glow bg-gradient-to-br from-bgd to-bgd-glow">
            <div class="grid grid-cols-3 gap-4 text-center">
              <div class="p-4 rounded-xl bg-bgd-deep/70 border border-teal-900/30">
                <div class="font-display text-3xl" id="statCourses">12</div>
                <div class="font-mono text-[10px] tracking-widest text-slate-400">COURSES</div>
              </div>
              <div class="p-4 rounded-xl bg-bgd-deep/70 border border-teal-900/30">
                <div class="font-display text-3xl" id="statTracks">4</div>
                <div class="font-mono text-[10px] tracking-widest text-slate-400">TRACKS</div>
              </div>
              <div class="p-4 rounded-xl bg-bgd-deep/70 border border-teal-900/30">
                <div class="font-display text-3xl" id="statTime">∞</div>
                <div class="font-mono text-[10px] tracking-widest text-slate-400">LIFETIME</div>
              </div>
            </div>
            <div class="mt-4 grid grid-cols-2 gap-3 items-center">
              <p class="font-mono text-xs text-slate-400">Tip: Be "Inspired by the fear of being average".</p>
              <div class="text-right">
                
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Courses Grid -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-24">
    <div id="courses" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6" aria-live="polite">

      <!-- Course cards are populated by JS from data below. -->
    </div>

    <!-- Modal: Course detail / preview -->
    <div id="modal" class="hidden fixed inset-0 z-60 flex items-center justify-center px-4" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-backdrop absolute inset-0 bg-black/60" id="modalBackdrop" aria-hidden="true"></div>
      <div class="relative z-10 max-w-3xl w-full rounded-2xl border border-teal-900/40 bg-bgd p-6 shadow-glow">
        <header class="flex items-start justify-between gap-4">
          <div>
            <h3 id="modalTitle" class="font-display text-xl">Course Title</h3>
            <p id="modalTags" class="font-mono text-xs text-slate-400 mt-1">tags</p>
          </div>
          <div class="flex gap-2">
            <a id="modalOpenCourse" class="rounded-lg border border-teal-900/50 px-3 py-1.5 text-sm font-mono" href="#" target="_blank" rel="noopener">Open</a>
            <button id="modalClose" class="rounded-lg border border-teal-900/50 px-3 py-1.5 text-sm font-mono">Close</button>
          </div>
        </header>
        <div class="mt-4">
          <p id="modalDesc" class="text-slate-400 text-sm">Course description</p>
          <div id="modalExtra" class="mt-3 text-xs text-slate-400 font-mono"></div>
        </div>
      </div>
    </div>

    <!-- Hidden file input for import -->
    <input type="file" id="importFile" accept="application/json" class="hidden" />

  </main>

  <!-- Footer -->
  <footer class="border-t border-teal-900/30 py-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col sm:flex-row items-center justify-between gap-4">
      <p class="font-mono text-xs text-slate-500">© <span id="year"></span> Anarchy. All rights reserved.</p>
      <div class="font-mono text-xs text-slate-500">Design: dark aqua • binary • GitS aesthetic</div>
    </div>
  </footer>

  <!-- Settings Drawer -->
  <aside id="settings" class="hidden fixed right-4 bottom-4 z-70 w-96 rounded-2xl border border-teal-900/40 p-4 bg-bgd shadow-glow" aria-hidden="true">
    <div class="flex items-center justify-between">
      <h4 class="font-display text-lg">Settings</h4>
      <button id="closeSettings" class="font-mono text-xs">Close</button>
    </div>
    <div class="mt-4 space-y-4">
      <div class="flex items-center justify-between">
        <div>
          <div class="font-mono text-xs">Binary Rain</div>
          <div class="font-mono text-[10px] text-slate-400">Toggle the ambient matrix rain.</div>
        </div>
        <div>
          <div id="toggleBinary" class="switch on" role="switch" aria-checked="true" tabindex="0"><div class="dot"></div></div>
        </div>
      </div>

      <div class="flex items-center justify-between">
        <div>
          <div class="font-mono text-xs">Reduced Motion</div>
          <div class="font-mono text-[10px] text-slate-400">Respect OS-level motion settings.</div>
        </div>
        <div>
          <div id="toggleMotion" class="switch" role="switch" aria-checked="false" tabindex="0"><div class="dot"></div></div>
        </div>
      </div>

      <div>
        <div class="font-mono text-xs mb-2">Local Analytics (fake)</div>
        <div id="analyticsPreview" class="rounded-lg border border-teal-900/30 p-3 text-slate-400 font-mono text-xs">
          Visits: <span id="fakeVisits">0</span> • Active: <span id="fakeActive">0</span>
        </div>
      </div>

      <div>
        <button id="resetBtn" class="rounded-lg border border-teal-900/40 px-3 py-2 text-sm font-mono">Reset to defaults</button>
      </div>
    </div>
  </aside>

  <!-- Floating quick actions -->
  <div class="fixed left-4 bottom-6 z-60 flex flex-col gap-3">
    <button id="focusSearchBtn" title="Focus search" class="rounded-full w-12 h-12 flex items-center justify-center border border-teal-900/30 bg-bgd/60 hover:bg-bgd-glow/50">🔎</button>
    <button id="openExplorer" title="Explorer" class="rounded-full w-12 h-12 flex items-center justify-center border border-teal-900/30 bg-bgd/60 hover:bg-bgd-glow/50">📁</button>
  </div>

  <script>
    /**************************************************************************
     * Fixed JS: binary rain reliably renders, animation loop remains alive
     * while toggling, and reset now restores the original seeded catalog
     * exactly (no extra 40 filler items).
     **************************************************************************/

    // Basic DOM refs
    const canvas = document.getElementById('binaryCanvas');
    const ctx = canvas.getContext('2d');
    let width, height, columns, drops;
    let fontSize = 16; // used by binary rain
    let binaryEnabled = true;
    let reducedMotion = false;
    const coursesRoot = document.getElementById('courses');
    const searchInput = document.getElementById('q');
    const clearBtn = document.getElementById('clearSearch');
    const chips = document.querySelectorAll('.filter-chip');
    const statCoursesEl = document.getElementById('statCourses');
    const yearEl = document.getElementById('year');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalDesc = document.getElementById('modalDesc');
    const modalTags = document.getElementById('modalTags');
    const modalExtra = document.getElementById('modalExtra');
    const modalClose = document.getElementById('modalClose');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalOpenCourse = document.getElementById('modalOpenCourse');
    const settingsDrawer = document.getElementById('settings');
    const openSettingsBtn = document.getElementById('openSettings');
    const closeSettingsBtn = document.getElementById('closeSettings');
    const toggleBinary = document.getElementById('toggleBinary');
    const toggleMotion = document.getElementById('toggleMotion');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const importFile = document.getElementById('importFile');
    const resetBtn = document.getElementById('resetBtn');
    const fakeVisitsEl = document.getElementById('fakeVisits');
    const fakeActiveEl = document.getElementById('fakeActive');

    const openExplorerBtn = document.getElementById('openExplorer');
    const focusSearchBtn = document.getElementById('focusSearchBtn');

    // Hover hint for keyboard actions
    const kbdHint = document.getElementById('kbdHint');

    // Year
    yearEl.textContent = new Date().getFullYear();

    // -------------------------------------------------------------------------
    // Binary rain implementation (fixed)
    // Key fixes:
    // - Use devicePixelRatio-aware sizing and ctx.setTransform to avoid scale accumulation
    // - Maintain a continuous animation loop even when disabled so toggle resumes
    // - Use row-based drops and increment by row (reliable stepping)
    // -------------------------------------------------------------------------
    function resetCanvas() {
      const ratio = window.devicePixelRatio || 1;
      const cssWidth = window.innerWidth;
      const cssHeight = window.innerHeight;

      // set CSS size for layout
      canvas.style.width = cssWidth + 'px';
      canvas.style.height = cssHeight + 'px';

      // set backing store size at device pixel ratio for crisp rendering
      canvas.width = Math.floor(cssWidth * ratio);
      canvas.height = Math.floor(cssHeight * ratio);

      // reset any transforms and scale the context to CSS px coordinates
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      ctx.scale(ratio, ratio);

      // compute columns using CSS pixels
      fontSize = 16; // px
      columns = Math.max(2, Math.floor(cssWidth / fontSize));
      const rows = Math.max(8, Math.floor(cssHeight / fontSize));

      // initialize drops as a row index for each column
      drops = Array.from({ length: columns }, () => Math.floor(Math.random() * rows));

      // remember width/height in CSS px for drawing convenience
      width = cssWidth;
      height = cssHeight;
    }

    // Animation loop (always schedules next RAF so toggles work)
    function drawBinary() {
      // Always request next frame so toggling will resume the loop
      requestAnimationFrame(drawBinary);

      // If disabled or user prefers reduced motion, clear and skip drawing
      if (!binaryEnabled || reducedMotion) {
        // clear the logical backing store (use full pixel dimensions)
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        return;
      }

      // fade old characters with a translucent rect
      ctx.fillStyle = 'rgba(7,11,12,0.08)';
      ctx.fillRect(0, 0, width, height);

      // draw binary characters
      ctx.fillStyle = '#00e5ff';
      ctx.font = `${fontSize}px "Share Tech Mono", monospace`;
      ctx.textBaseline = 'top';

      for (let i = 0; i < columns; i++) {
        const char = Math.random() > 0.5 ? '0' : '1';
        const x = i * fontSize;
        const y = drops[i] * fontSize;

        ctx.fillText(char, x, y);

        // step the drop down by one row
        drops[i] = drops[i] + 1;

        // reset with small probability when it passes bottom
        if (y > height && Math.random() > 0.975) {
          drops[i] = 0;
        }
      }
    }

    window.addEventListener('resize', () => {
      resetCanvas();
    });

    // initialize canvas and start animation loop
    resetCanvas();
    requestAnimationFrame(drawBinary);

    // -------------------------------------------------------------------------
    // Data: seed many courses (for "surprise" expansion)
    // We'll capture a snapshot of the seeded catalog so Reset can restore it
    // exactly (no extra "reset" items).
    // -------------------------------------------------------------------------
    const courseIframes = {
      'adv-prompt-1': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108161" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'win-exploit-1': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108209" height="277" width="236" frameborder="0" scrolling="no" ></iframe>',
      'psyops-1': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=326299935487704016" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'llm-systems-engineering': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108119" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'anonymity': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108106" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'off-python': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108102" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'off-c': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108131" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'intell-anal': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108278" height="277" width="236" frameborder="0" scrolling="no" ></iframe>',
      'asm': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108144" height="297" width="236" frameborder="0" scrolling="no" ></iframe>',
      'v-disc': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108411" height="305" width="236" frameborder="0" scrolling="no" ></iframe>',
      'geo-cyber-strat': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130103798" height="277" width="236" frameborder="0" scrolling="no" ></iframe>',
      'cog-war-app': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108220" height="277" width="236" frameborder="0" scrolling="no" ></iframe>',
      'adv-ml': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108267" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'ai-off-sec': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108375" height="279" width="236" frameborder="0" scrolling="no" ></iframe>',
      'def-ai-sec': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108398" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'apt': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108276" height="277" width="236" frameborder="0" scrolling="no" ></iframe>',
      'shellcode': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108333" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'comp': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108371" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'embedded': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108399" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'kernel': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108377" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'win-internals': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108404" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'hyperv-internals': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108401" height="336" width="236" frameborder="0" scrolling="no" ></iframe>',
      'reversing': '<iframe src="https://assets.pinterest.com/ext/embed.html?id=651544271130108367" height="199" width="236" frameborder="0" scrolling="no" ></iframe>',

    }



    const initialCourses = [
      {
        id: 'adv-prompt-1',
        title: 'Applied Exploit & Malware Development (AEMD)',
        desc: 'Offensive malware development. You will learn how to create malware from the ground-up for the Windows Operating System.',
        tags: ['exploits','red-team','security'],
        href: '#',
        img: 'tunnel.gif'
      },
      {
        id: 'win-exploit-1',
        title: 'Windows Exploit Development',
        desc: 'From stack smashing to ROP chains and mitigation bypasses. Practical labs included.',
        tags: ['exploits','re','windows'],
        href: 'https://spectra.coursestack.com/courses/183ba276-e121-46c0-8aad-4cd372653a72',
        img: 'final.gif'
      },
      {
        id: 'psyops-1',
        title: 'Psychological Operations Primer',
        desc: 'Audience analysis, influence frameworks, content ops, and field ethics—applied with modern platforms.',
        tags: ['psyops','intel'],
        href: '#',
        img: 'glitch.gif'
      },
      {
        id: 'llm-systems-engineering',
        title: 'LLM Systems Engineering',
        desc: 'Students will learn how to build their own models.',
        tags: ['AI/ML'],
        href: '#',
        img: 'llm23.gif'
      },
      {
        id: 'anonymity',
        title: 'Anonymity',
        desc: 'Learn the ever-watchful eyes prying into your digital life, and how to protect the most you can.',
        tags: ['strategy'],
        href: '#',
        img: 'cool.gif'
      },
      {
        id: 'off-python',
        title: 'Offensive Python',
        desc: 'Learn how to use python for creating tools on the offensive side.',
        tags: ['code', 'exploits'],
        href: '#',
        img: 'sh.gif'
      },
      {
        id: 'off-c',
        title: 'Offensive C',
        desc: 'Learn how to use C for creating tools on the offensive side.',
        tags: ['code', 'exploits'],
        href: '#',
        img: 'download.gif'
      },
      {
        id: 'intell-anal',
        title: 'Intelligence Analysis',
        desc: 'Learn how to use online and offline resources to your advantage.',
        tags: ['strategy'],
        href: '#',
        img: 'theOne.gif'
      },
      {
        id: 'asm',
        title: 'x86-x64 ASM',
        desc: 'Masterclass in understanding and navigating through both 32-bit and 64-bit Assembly Architecture.',
        tags: ['code'],
        href: '#',
        img: 'circle.gif'
      },
      {
        id: 'v-disc',
        title: 'Vulnerability Discovery',
        desc: 'A practical guide to vulnerability research.',
        tags: ['windows', 'exploits'],
        href: '#',
        img: 'k.gif'
      },
      {
        id: 'geo-cyber-strat',
        title: 'Geopolitical Cyber Strategy',
        desc: 'Case studies of APTs & the cyber power projection.',
        tags: ['strategy'],
        href: '#',
        img: 'gl.gif'
      },
      {
        id: 'cog-war-app',
        title: 'Cognitive Warfare Applications',
        desc: 'Learn the strategies big tech, giants, and those behind the scenes have at play.',
        tags: ['strategy'],
        href: '#',
        img: '1111.gif'
      },
      {
        id: 'adv-ml',
        title: 'Adversarial Machine Learning',
        desc: 'Learn how ML can be used offensively by threat actors.',
        tags: ['code', 'AI/ML'],
        href: '#',
        img: 'land.gif'
      },
      {
        id: 'ai-off-sec',
        title: 'AI-Driven Offensive Security',
        desc: 'Using Artificial Intelligence to augment offensive security.',
        tags: ['code', 'AI/ML'],
        href: '#',
        img: 'black.gif'
      },
      {
        id: 'def-ai-sec',
        title: 'Defensive AI for Detection',
        desc: 'Equip yourself with AI-assisted threat hunting.',
        tags: ['code', 'AI/ML'],
        href: '#',
        img: 'redg.gif'
      },
      {
        id: 'apt',
        title: 'Advanced Persistence & Evasion',
        desc: 'Coming Soon.',
        tags: ['code', 'windows'],
        href: '#',
        img: 'fgh.gif'
      },
      {
        id: 'shellcode',
        title: 'Shellcode Development & Obfuscation',
        desc: 'Coming Soon.',
        tags: ['code', 'windows'],
        href: '#',
        img: 'maze.gif'
      },
      {
        id: 'comp',
        title: 'Compiler & Linker Internals',
        desc: 'Understand how binaries are built.',
        tags: ['code'],
        href: '#',
        img: 'hole.gif'
      },
      {
        id: 'embedded',
        title: 'Embedded Systems Exploitation',
        desc: 'Coming Soon.',
        tags: ['code', 'exploits'],
        href: '#',
        img: 'red.gif'
      },
      {
        id: 'kernel',
        title: 'Kernel Exploitation',
        desc: 'Windows & Linux Kernel mode attacks.',
        tags: ['code', 'windows', 'exploits'],
        href: '#',
        img: 'grid.gif'
      },
      {
        id: 'win-internals',
        title: 'Windows OS Internals',
        desc: 'Learn about the inner system of the Windows OS.',
        tags: ['code', 'windows'],
        href: '#',
        img: 'loop.gif'
      },
      {
        id: 'hyperv-internals',
        title: 'Hyper-V Internals',
        desc: 'Learn about the inner system of the Hyper-V environment.',
        tags: ['code', 'windows'],
        href: '#',
        img: 'rwa.gif'
      },
      {
        id: 'reversing',
        title: 'Reverse Engineering using Ghidra',
        desc: 'Coming Soon.',
        tags: ['code', 'reversing'],
        href: '#',
        img: '1234.gif'
      }
    ];

    let coursesData = [];
    (function seedExplicit() {
        initialCourses.forEach(c => coursesData.push(c));
    })();

    // take a deep copy snapshot of the seeded catalog for Reset
    const seedSnapshot = JSON.stringify(coursesData);

    // -------------------------------------------------------------------------
    // Render course card
    // -------------------------------------------------------------------------
    function renderCourseCard(course) {
        const aTags = course.tags.map(t => 
            `<span class="rounded-full border border-teal-900/40 px-2 py-0.5 text-[10px]">${escapeHtml(t)}</span>`
        ).join(' ');


    
    // If course.img is defined, render an image at the top
    const imgHtml = course.img 
        ? `<img src="${escapeHtml(course.img)}" alt="${escapeHtml(course.title)}" class="w-full h-40 object-cover rounded-lg mb-3"/>` 
        : '';


    // Detect if the "img" field is a Pinterest embed link
    let mediaHtml = '';
    if (course.img) {
      if (course.img.includes("pinterest.com")) {
        mediaHtml = `
          <iframe src="${escapeHtml(course.img)}" 
            class="w-full h-40 rounded-lg mb-3" 
            style="border:none;" 
            loading="lazy">
          </iframe>`;
      } else {
        mediaHtml = `
          <img src="${escapeHtml(course.img)}" 
            alt="${escapeHtml(course.title)}" 
            class="w-full h-40 object-cover rounded-lg mb-3"/>`;
      }
    }



    const html = `
        <article class="card group relative rounded-2xl border border-teal-900/40 bg-bgd/70 p-5 shadow-glow" 
                data-tags="${escapeHtml(course.tags.join(','))}" 
                data-id="${escapeHtml(course.id)}" 
                tabindex="0" role="article" 
                aria-label="${escapeHtml(course.title)}">
        <div class="absolute left-0 top-0 h-0.5 w-2/3 bg-gradient-to-r from-neon-cyan to-neon-teal card-line" aria-hidden="true"></div>
        ${imgHtml}
        <header class="flex items-start gap-3">
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden="true" class="mt-1">
                <rect x="3" y="3" width="7" height="7" stroke="#00ffc6" stroke-width="1.5"/>
                <rect x="14" y="3" width="7" height="7" stroke="#00e5ff" stroke-width="1.5"/>
                <rect x="3" y="14" width="7" height="7" stroke="#00e5ff" stroke-width="1.5"/>
                <rect x="14" y="14" width="7" height="7" stroke="#00ffc6" stroke-width="1.5"/>
            </svg>
            <div>
                <h3 class="font-display text-lg leading-tight">${escapeHtml(course.title)}</h3>
                <p class="text-sm text-slate-400">${escapeHtml(course.desc)}</p>
            </div>
        </header>
        <footer class="mt-4 flex items-center justify-between">
            <div class="flex flex-wrap gap-2 font-mono text-[10px] text-slate-400">
                ${aTags}
            </div>
            <div class="flex gap-2">
                <a class="launch-btn rounded-lg border border-teal-900/50 px-3 py-1.5 text-sm font-mono hover:bg-bgd-glow/50" 
                    href="${escapeHtml(course.href)}" target="_blank" rel="noopener">Launch</a>
                <button class="copy-btn rounded-lg border border-teal-900/50 px-3 py-1.5 text-sm font-mono" 
                    data-url="${escapeHtml(course.href)}">Copy</button>
                <button class="open-btn rounded-lg border border-teal-900/50 px-3 py-1.5 text-sm font-mono">Inspect</button>
            </div>
        </footer>
    </article>
    `;
    return html;
}


    // Escape utility for safety
    function escapeHtml(s) {
      if (!s && s !== 0) return '';
      return String(s)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    // Render all cards initially
    function renderAllCourses() {
      coursesRoot.innerHTML = coursesData.map(renderCourseCard).join('\n');
      attachCardHandlers();
      applyFilters();
    }

    // -------------------------------------------------------------------------
    // Filtering & search
    // -------------------------------------------------------------------------
    function applyFilters() {
      const q = (searchInput.value || '').toLowerCase().trim();
      const active = document.querySelector('.filter-chip.active')?.dataset.filter || 'all';
      let visible = 0;
      const allCards = [...coursesRoot.querySelectorAll('.card')];
      allCards.forEach(card => {
        const tags = (card.dataset.tags || '').toLowerCase();
        const text = (card.innerText || '').toLowerCase();
        const matchesQuery = !q || text.includes(q) || tags.includes(q);
        const matchesChip = active === 'all' || tags.includes(active);
        const show = matchesQuery && matchesChip;
        card.style.display = show ? '' : 'none';
        if (show) visible++;
      });
      statCoursesEl.textContent = String(visible).padStart(2, '0');
    }

    // Hook up chip clicks
    chips.forEach(chip => chip.addEventListener('click', () => {
      chips.forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      // Accessibility: update aria-selected
      chips.forEach(c => c.setAttribute('aria-selected', c.classList.contains('active') ? 'true' : 'false'));
      applyFilters();
    }));

    searchInput.addEventListener('input', () => {
      applyFilters();
      // tiny keyboard hint
      if (searchInput.value.length > 0) kbdHint.textContent = 'Esc clears';
    });

    clearBtn.addEventListener('click', () => {
      searchInput.value = '';
      applyFilters();
      searchInput.focus();
    });

    // -------------------------------------------------------------------------
    // Card buttons, copy to clipboard, modal details
    // -------------------------------------------------------------------------
    function attachCardHandlers() {
      document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.removeEventListener('click', copyHandler);
        btn.addEventListener('click', copyHandler);
      });
      document.querySelectorAll('.open-btn').forEach(btn => {
        btn.removeEventListener('click', openHandler);
        btn.addEventListener('click', openHandler);
      });
      // Make cards open on Enter
      document.querySelectorAll('#courses .card').forEach(card => {
        card.removeEventListener('keydown', cardKeyHandler);
        card.addEventListener('keydown', cardKeyHandler);
        card.removeEventListener('dblclick', cardDblHandler);
        card.addEventListener('dblclick', cardDblHandler);
      });
    }

    async function copyHandler(e) {
      const btn = e.currentTarget;
      const url = btn.dataset.url || btn.closest('article').querySelector('.launch-btn')?.href || '';
      try {
        await navigator.clipboard.writeText(url || '');
        const old = btn.textContent;
        btn.textContent = 'Copied';
        setTimeout(() => (btn.textContent = old || 'Copy'), 1200);
      } catch (err) {
        btn.textContent = 'Failed';
        setTimeout(() => (btn.textContent = 'Copy'), 1200);
      }
    }

    function openHandler(e) {
      const btn = e.currentTarget;
      const article = btn.closest('article');
      if (!article) return;
      const id = article.dataset.id;
      const course = coursesData.find(c => c.id === id);
      if (!course) return;
      modalTitle.textContent = course.title;
      modalDesc.textContent = course.desc;
      modalTags.textContent = course.tags.join(' • ');
      modalExtra.innerHTML = `<div class="mt-2 font-mono text-xs text-slate-400">Course ID: ${escapeHtml(course.id)}</div>`;
      modalOpenCourse.href = course.href || '#';
      openModal();
    }

    function cardKeyHandler(e) {
      if (e.key === 'Enter') {
        const article = e.currentTarget;
        const id = article.dataset.id;
        const course = coursesData.find(c => c.id === id);
        if (!course) return;
        modalTitle.textContent = course.title;
        modalDesc.textContent = course.desc;
        modalTags.textContent = course.tags.join(' • ');
        modalExtra.innerHTML = `<div class="mt-2 font-mono text-xs text-slate-400">Course ID: ${escapeHtml(course.id)}</div>`;
        openModal();
      }
      if (e.key === 'c' && (navigator.clipboard)) {
        const article = e.currentTarget;
        const url = article.querySelector('.launch-btn')?.href || '';
        navigator.clipboard.writeText(url || '');
      }
    }

    function cardDblHandler(e) {
      const article = e.currentTarget;
      const id = article.dataset.id;
      const course = coursesData.find(c => c.id === id);
      if (course && course.href && course.href !== '#') {
        window.open(course.href, '_blank', 'noopener');
      } else {
        // subtle animation (no JS heavy)
        article.classList.add('animate-pulse');
        setTimeout(() => article.classList.remove('animate-pulse'), 400);
      }
    }

    // Modal open/close
    function openModal() {
      modal.classList.remove('hidden');
      modal.setAttribute('aria-hidden', 'false');
      // trap focus minimal
      modal.querySelector('[id^="modal"]').focus?.();
    }
    function closeModal() {
      modal.classList.add('hidden');
      modal.setAttribute('aria-hidden', 'true');
    }
    modalClose.addEventListener('click', closeModal);
    modalBackdrop.addEventListener('click', closeModal);

    // -------------------------------------------------------------------------
    // Settings drawer interactions
    // -------------------------------------------------------------------------
    openSettingsBtn.addEventListener('click', () => {
      settingsDrawer.classList.remove('hidden');
      settingsDrawer.setAttribute('aria-hidden', 'false');
    });
    closeSettingsBtn.addEventListener('click', () => {
      settingsDrawer.classList.add('hidden');
      settingsDrawer.setAttribute('aria-hidden', 'true');
    });

    // Toggle binary (toggling won't break the RAF loop because drawBinary always requests another frame)
    toggleBinary.addEventListener('click', () => {
      binaryEnabled = !binaryEnabled;
      toggleBinary.classList.toggle('on', binaryEnabled);
      toggleBinary.setAttribute('aria-checked', String(binaryEnabled));
    });
    toggleMotion.addEventListener('click', () => {
      reducedMotion = !reducedMotion;
      toggleMotion.classList.toggle('on', reducedMotion);
      toggleMotion.setAttribute('aria-checked', String(reducedMotion));
    });

    // Quick actions
    focusSearchBtn.addEventListener('click', () => {
      searchInput.focus();
    });

    openExplorerBtn.addEventListener('click', () => {
      // Faked explorer: filter to "infra"
      chips.forEach(c => c.classList.remove('active'));
      document.querySelectorAll('.filter-chip[data-filter="infra"]')[0]?.classList.add('active');
      applyFilters();
    });


    // -------------------------------------------------------------------------
    // RESET: restore exactly the seeded catalog snapshot (no extras)
    // -------------------------------------------------------------------------
    resetBtn.addEventListener('click', () => {
      if (!confirm('Reset to defaults?')) return;
      try {
        coursesData = JSON.parse(seedSnapshot);
        renderAllCourses();
        alert('Catalog restored to default seeded state.');
      } catch (err) {
        alert('Reset failed: ' + err.message);
      }
    });

    // -------------------------------------------------------------------------
    // Tiny fake analytics
    // -------------------------------------------------------------------------
    let fakeVisits = 1205;
    let fakeActive = 3;
    function tickAnalytics() {
      fakeVisits += Math.floor(Math.random() * 5);
      fakeActive = Math.max(1, Math.floor(Math.random() * 8));
      fakeVisitsEl.textContent = fakeVisits;
      fakeActiveEl.textContent = fakeActive;
    }
    setInterval(tickAnalytics, 4000);
    tickAnalytics();

    // -------------------------------------------------------------------------
    // Misc: keyboard shortcuts and accessibility
    // -------------------------------------------------------------------------
    document.addEventListener('keydown', (e) => {
      // Focus search on slash
      if (e.key === '/' && document.activeElement !== searchInput) {
        e.preventDefault();
        searchInput.focus();
        return;
      }
      // Escape clears search or closes modal/drawer
      if (e.key === 'Escape') {
        if (!modal.classList.contains('hidden')) {
          closeModal();
          return;
        }
        if (!settingsDrawer.classList.contains('hidden')) {
          settingsDrawer.classList.add('hidden');
          return;
        }
        if (searchInput.value) {
          searchInput.value = '';
          applyFilters();
        }
      }
      // j/k navigate visible cards (simple)
      if ((e.key === 'j' || e.key === 'ArrowDown') && document.activeElement.tagName !== 'INPUT') {
        focusNextCard(1);
      }
      if ((e.key === 'k' || e.key === 'ArrowUp') && document.activeElement.tagName !== 'INPUT') {
        focusNextCard(-1);
      }
    });

    function focusNextCard(delta) {
      const visible = [...document.querySelectorAll('#courses .card')].filter(c => c.style.display !== 'none');
      if (!visible.length) return;
      const idx = visible.indexOf(document.activeElement);
      let next = 0;
      if (idx === -1) next = 0;
      else next = (idx + delta + visible.length) % visible.length;
      visible[next].focus();
      // tiny visual hint
      visible[next].classList.add('ring-2','ring-neon-cyan','ring-offset-2');
      setTimeout(() => visible[next].classList.remove('ring-2','ring-neon-cyan','ring-offset-2'), 500);
    }

    // -------------------------------------------------------------------------
    // Card handlers attachment after initial render
    // -------------------------------------------------------------------------
    function attachCardHandlersDebounced() {
      setTimeout(attachCardHandlers, 120);
    }

    // -------------------------------------------------------------------------
    // Easter eggs (left as-is)
    // -------------------------------------------------------------------------
    searchInput.addEventListener('input', () => {
      const v = searchInput.value.toLowerCase();
      if (v === 'neo') {
        simulateArchitect();
      }
    });

    function simulateArchitect() {
      const overlay = document.createElement('div');
      overlay.className = 'fixed inset-0 z-80 flex items-center justify-center';
      overlay.innerHTML = `
        <div class="rounded-2xl border border-teal-900/40 p-8 bg-bgd shadow-glow text-center">
          <h3 class="font-display text-2xl mb-2">The Architect</h3>
          <p class="font-mono text-sm text-slate-400">You found a hidden filament. Legacy systems detect curiosity.</p>
          <div class="mt-4"><button id="archClose" class="rounded-lg border border-teal-900/40 px-4 py-2">Dismiss</button></div>
        </div>
      `;
      document.body.appendChild(overlay);
      overlay.querySelector('#archClose').addEventListener('click', () => overlay.remove());
      setTimeout(() => overlay.remove(), 8000);
    }

    const KONAMI = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','b','a'];
    let konamiBuffer = [];
    document.addEventListener('keydown', (e) => {
      konamiBuffer.push(e.key);
      if (konamiBuffer.join(',').includes(KONAMI.join(','))) {
        triggerKonami();
        konamiBuffer = [];
      }
      if (konamiBuffer.length > KONAMI.length) konamiBuffer.shift();
    });

    function triggerKonami() {
      const secret = {
        id: 'secret-konami',
        title: 'Spectre — Secret Training',
        desc: 'A hidden capstone: a multi-domain challenge. For curious operators only.',
        tags: ['secret','capstone','spectre'],
        href: '#'
      };
      coursesData.unshift(secret);
      renderAllCourses();
      alert('Spectre module unlocked.');
    }

    // -------------------------------------------------------------------------
    // Init render
    // -------------------------------------------------------------------------
    renderAllCourses();
    attachCardHandlersDebounced();

    // Convenience: click logo scrolls to top and focuses search
    document.getElementById('logoBtn').addEventListener('click', (e) => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      searchInput.focus();
    });

    applyFilters();

    // Accessibility: announce number of visible courses when filters change
    const liveRegion = document.createElement('div');
    liveRegion.setAttribute('aria-live', 'polite');
    liveRegion.className = 'sr-only';
    document.body.appendChild(liveRegion);
    const announceVisible = debounce(() => {
      liveRegion.textContent = `${statCoursesEl.textContent} courses visible.`;
    }, 200);
    searchInput.addEventListener('input', announceVisible);
    chips.forEach(c => c.addEventListener('click', announceVisible));

    // Utility: debounce
    function debounce(fn, ms=80){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); };}

    // End of fixed script
  </script>

</body>
</html>

